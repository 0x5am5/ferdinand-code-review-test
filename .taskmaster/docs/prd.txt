## **Problem Statement**

Ferdinand users currently manage brand assets across scattered Google Drive folders, making it difficult to maintain a centralized brand asset library. Teams need a seamless way to connect their existing Google Drive files and folders to Ferdinand's Brand Assets manager without manual downloads and re-uploads.

## **Goals**

- Enable users to connect their Google Drive account to Ferdinand
- Allow users to import files and folders from Google Drive into Brand Assets
- Store references to Google Drive files (not copies) while maintaining Ferdinand's asset management features
- Preserve Drive file metadata and permissions in Ferdinand
- Provide a smooth OAuth authentication flow

## **User Stories**

- **As a Marketing Manager**, I want to connect my Google Drive so I can import existing brand folders without re-uploading files.
- **As a Designer**, I want to select specific files from my Drive so I can add them to Ferdinand's brand library.
- **As an Admin**, I want to import an entire Drive folder so my team can access all brand assets in one place.
- **As a Team Member**, I want imported Drive files to respect my existing Drive permissions so I only see what I'm allowed to access.
- **As a User**, I want to see when Drive files were last modified so I know if they're up to date.

## **Key Features**

### 1. **Google OAuth Authentication**
- Implement OAuth 2.0 flow for Google Drive access
- Request minimum required scopes:
  - `drive.readonly` - Read access to Drive files
  - `drive.metadata.readonly` - Read file metadata
- Store OAuth tokens securely (encrypted in database)
- Handle token refresh automatically
- Allow users to disconnect Drive integration

### 2. **Google Drive Picker Integration**
- Embed Google Drive Picker UI in Ferdinand
- Allow users to select:
  - Individual files
  - Multiple files
  - Entire folders
- Display file previews in picker
- Filter by file types if needed

### 3. **File and Folder Import**
- Import individual files with full metadata
- Flatten folder imports (all files at same level, no folder hierarchy for MVP)
- Store Drive file references, not copies:
  - Google Drive file ID
  - File name
  - File type/MIME type
  - File size
  - Owner information
  - Last modified date
  - Thumbnail URL (if available)
  - Direct Drive link
- Associate imported files with Ferdinand user who imported them
- Map files to Brand Assets with appropriate metadata

### 4. **Permissions Integration**
- Respect Ferdinand's role-based permissions:
  - User who imports files becomes the "owner" in Ferdinand
  - Apply Ferdinand's existing permission model on top of Drive files
  - **Guest**: View only files explicitly shared
  - **Standard**: View all imported files, edit own imports
  - **Admin/Super Admin**: Full access to all imported files
- Store permission metadata from Drive for reference
- Display Drive sharing status in Ferdinand UI

### 5. **File Access and Viewing**
- Generate secure URLs to access Drive files
- Display Drive file thumbnails in Brand Assets grid
- Link to "Open in Google Drive" for editing
- Show file metadata (last modified, owner, size)
- Handle Drive permission errors gracefully
- Cache thumbnails for performance

### 6. **UI/UX**
- "Connect Google Drive" button in Brand Assets section
- OAuth consent screen with clear permission explanation
- Drive Picker modal for file selection
- Import progress indicator for bulk imports
- Visual indicator for Drive-sourced files (icon/badge)
- "Imported from Google Drive" filter/tag
- Drive connection status in user settings
- "Disconnect Drive" option

## **Technical Requirements**

### Backend
- **OAuth Flow**: Implement Google OAuth 2.0 server-side
- **Token Storage**: Encrypt and store access/refresh tokens in database
- **Drive API Integration**: Use Google Drive API v3 for:
  - File metadata retrieval
  - Folder contents listing
  - Thumbnail generation
  - File access
- **Database Schema**:
  - `google_drive_connections` table (user_id, encrypted_tokens, scopes, connected_at)
  - Extend `brand_assets` table with Drive-specific fields (drive_file_id, drive_owner, drive_modified_at, is_drive_file)
- **API Endpoints**:
  - `POST /api/google-drive/auth` - Initiate OAuth
  - `GET /api/google-drive/callback` - OAuth callback
  - `GET /api/google-drive/status` - Check connection status
  - `POST /api/google-drive/import` - Import files/folders
  - `DELETE /api/google-drive/disconnect` - Remove connection
  - `GET /api/google-drive/files/:id` - Get Drive file metadata
- **Error Handling**: Handle Drive API errors, expired tokens, permission issues

### Frontend
- **Google Drive Picker**: Integrate Google Picker API
- **OAuth Flow**: Handle redirect and token exchange
- **UI Components**:
  - Drive connection button
  - OAuth consent modal
  - File picker modal
  - Import status indicator
  - Drive file badges/icons
- **State Management**: Track Drive connection status, imported files

### Security
- Encrypt OAuth tokens at rest
- Use HTTPS for all Drive API calls
- Validate Drive file permissions before serving
- Implement rate limiting on Drive API endpoints
- Store minimal necessary data from Drive

## **Success Criteria**

- Users can successfully authenticate with Google Drive via OAuth
- Users can import individual files and folders from Drive
- Imported files display correctly in Brand Assets with metadata
- Drive file thumbnails render properly
- Permissions are enforced according to Ferdinand roles
- OAuth tokens refresh automatically without user intervention
- Users can disconnect Drive integration
- Import process handles at least 100 files from a single folder
- Error messages are clear and actionable when Drive access fails

## **Technical Constraints**

- MVP excludes real-time sync (Drive changes don't auto-update in Ferdinand)
- MVP excludes nested folder hierarchy (folders are flattened)
- MVP excludes editing Drive files directly from Ferdinand
- No file versioning tracking
- No two-way sync (changes in Ferdinand don't affect Drive)

## **Future Enhancements (V2+)**

- Real-time sync: Watch Drive for file changes and update Ferdinand
- Two-way sync: Update Drive files from Ferdinand
- Folder hierarchy preservation
- Batch re-import to refresh metadata
- Drive file search from within Ferdinand
- Selective sync rules (only certain folders/file types)
- Team Drive / Shared Drive support
- Drive activity logs (who accessed what)
- In-app Drive file preview/editing

## **Non-Goals**

- Storing duplicate copies of Drive files in Ferdinand storage
- Real-time collaboration features (comments, suggestions)
- Converting Drive file formats
- Syncing Ferdinand uploads to Drive
- Supporting other cloud storage providers in this iteration (Dropbox, OneDrive, etc.)
